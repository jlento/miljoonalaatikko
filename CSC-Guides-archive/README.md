CSC Guides
==========

This package contains tools for genarating PDF books from multi-page
HTML sources using pandoc <http://pandoc.org>. More specifically, this
is used to generate CSC's users' guides from the Liferay portal
<https://research.csc.fi/guides>.


Installing
----------

The tools should be possible to install on any reasonable fresh Linux
distribution. The exact dependencies (for Ubuntu 15.04) can be read
from the Ansible <http://www.ansible.com> playbook
[playbook.yml](https://raw.githubusercontent.com/jlento/CSC-Guides/master/playbook.yml).

If you have a remote server in `<ip address>` running Ubuntu 15.04
(requires >1GB memory) in CSC's Pouta cluster, for example, the
following should push the software stack on the server:

    cat > inventory <<EOF
    [publishing-platform]
    <ip address>
	EOF
    ssh-agent bash
    ssh-add <key>
    ansible-playbook playbook.yml -i inventory


Making books
------------

By default, make generates all books defined in the `<book-name>.mk` files.

    make -f ~/github/CSC-Guides/makefile

Generating a single book is possible by giving
it's name as an argument to make, with

    make -f ~/github/CSC-Guides/makefile <book-name>.pdf

Testing the conversion on separate www-pages is easy. Just copy the
pandoc command that make issues, with only a single or a few urls.

The ouput files are written in the current (build) directory.


Adding a book
-------------

A new book can be generated by writing a corresponding
`<book-name>.mk` file. The file should contain two make variable
definitions, for `$(this)_TITLE` and `$(this)_URLS`. The
`<book-name>.mk` files are included into the main makefile, so in
principle one can add further customizations there, too.

Variable `$(this)_URLS` contains the list of the pages (without
the base url) from which the book is made of.

Have a look at the included `*.mk` files for reference.

There is also an utililty `greplinks` in the `utils` subdirectory of
this package, which can be used if there already exist a HTML page which
links to separate pages. Compile and use example:

    make -f ~/github/CSC-Guides/makefile greplinks
    pandoc --filter ./greplinks https://research.csc.fi/csc-guide-introduction


Source formatting
-----------------

### Non-printing sections

Content that should be left out of the book can be enclosed inside tags

    <div class="no-print">
    ...
    </div>

Have a look at page <https://research.csc.fi/csc-guide> source, for example.


### Overflowing tables

Tables may sometimes overflow in the pdf-output. Adding the `colgroup`
with relative column widths after the `<table ...` tag gives
pandoc/latex enough guide to split long lines to multiple lines within a
table cell. For example:

    <table>
    <colgroup>
    <col width="20%" />
    <col width="20%" />
    <col width="60%" />
    </colgroup>
    ...
    </table>


### Overflowing code blocks

Overflowing code blocks can often be fixed by enclosing them into
`<pre>`...`</pre>` blocks in the source HTML pages.


Further development
-------------------

Pandoc produces the PDF output using pdflatex. The final layout
and style can be controlled by modifying pandoc's latex template
or by adding latex headers, such as graybox.tex in the utils directory
of this package.
